{% if message %}
<div class="message {% if 'Error' in message %}message-error{% else %}message-success{% endif %}" id="success-message">
    {{ message }}
</div>
{% endif %}

<div class="grid status-controls">
    <button hx-post="/api/client/start" 
            hx-target="#tab-content" 
            hx-swap="innerHTML"
            hx-trigger="click"
            {% if status.running %}disabled{% endif %}>
        ‚ñ∂ Start
    </button>
    <button hx-post="/api/client/stop" 
            hx-target="#tab-content" 
            hx-swap="innerHTML"
            hx-trigger="click"
            {% if not status.running %}disabled{% endif %}>
        ‚èπ Stop
    </button>
    <button hx-post="/api/client/restart" 
            hx-target="#tab-content" 
            hx-swap="innerHTML"
            hx-trigger="click"
            {% if not status.running %}disabled{% endif %}>
        üîÑ Restart
    </button>
</div>

<div id="status-info" hx-get="/api/status/partial" hx-trigger="" hx-swap="innerHTML">
    <!-- Playback Section -->
    <article>
        <header>
            <h3>Playback</h3>
        </header>
        {% if status.title or status.artist %}
        <p class="status-paragraph">
            <mark class="{% if status.playback_state == 'PLAYING' %}secondary{% elif status.playback_state == 'PAUSED' %}contrast{% else %}tertiary{% endif %} status-mark">
                {% if status.playback_state == 'PLAYING' %}‚ñ∂{% elif status.playback_state == 'PAUSED' %}‚è∏{% else %}‚èπ{% endif %}
                {{ status.playback_state or 'STOPPED' }}
            </mark>
            <strong>{{ status.title or 'Unknown Title' }}</strong>
            <small> ‚Ä¢ {{ status.artist or 'Unknown Artist' }}{% if status.album %} ‚Ä¢ {{ status.album }}{% endif %}</small>
        </p>
        {% if status.track_progress is not none and status.track_duration is not none %}
        <div class="status-progress-container">
            {% set progress_pct = (status.track_progress / status.track_duration * 100) if status.track_duration > 0 else 0 %}
            <progress value="{{ progress_pct }}" max="100" class="status-progress"></progress>
            <div class="grid status-time-grid">
                {% set progress_min = (status.track_progress / 60000)|int %}
                {% set progress_sec = ((status.track_progress / 1000) % 60)|int %}
                {% set duration_min = (status.track_duration / 60000)|int %}
                {% set duration_sec = ((status.track_duration / 1000) % 60)|int %}
                <small class="status-no-margin">{{ progress_min }}:{{ "%02d"|format(progress_sec) }}</small>
                <small class="status-no-margin" style="text-align: right;">{{ duration_min }}:{{ "%02d"|format(duration_sec) }}</small>
            </div>
        </div>
        {% endif %}
        {% if status.volume is not none %}
        <div class="status-volume-control">
            <small class="status-volume-label">Volume: {{ status.volume }}%{% if status.muted %} üîá{% endif %}</small>
            <progress value="{{ status.volume }}" max="100" class="{% if status.muted %}contrast{% endif %} status-volume-bar"></progress>
        </div>
        {% endif %}
        {% else %}
        <p class="status-no-margin"><em>No track playing</em></p>
        {% endif %}
    </article>
    
    <!-- Server Status Section -->
    <article>
        <header>
            <h3>Server Status</h3>
        </header>
        <p class="status-paragraph">
            <span class="status-indicator {% if status.running %}status-running{% else %}status-stopped{% endif %}"></span>
            <strong>{% if status.running %}Running{% else %}Stopped{% endif %}</strong>
            {% if status.connection_status and status.connection_status != 'disconnected' %}
            <small>({{ status.connection_status }})</small>
            {% endif %}
        </p>
        <dl class="status-no-margin">
            <dt>Server</dt>
            <dd>{{ status.server_url or 'Not configured' }}</dd>
            <dt>Client</dt>
            <dd>{{ status.client_name }}</dd>
        </dl>
        {% if status.last_error %}
        <p class="status-error"><mark class="contrast"><strong>Error:</strong> {{ status.last_error }}</mark></p>
        {% endif %}
    </article>
    
    <!-- Audio Device Section -->
    <article>
        <header>
            <h3>Audio Device</h3>
        </header>
        {% if status.audio_device %}
        <dl class="status-no-margin">
            <dt>Device</dt>
            <dd>{{ status.audio_device.name }}</dd>
            <dt>Channels</dt>
            <dd>{{ status.audio_device.channels }}ch</dd>
            {% if status.audio_format %}
            <dt>Format</dt>
            <dd>{{ status.audio_format.sample_rate }}Hz, {{ status.audio_format.channels }}ch</dd>
            {% endif %}
        </dl>
        {% else %}
        <p class="status-no-margin"><small>Default device</small></p>
        {% endif %}
    </article>
</div>
